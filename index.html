<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chill Guy 측정기</title>
  <style>
    /* 전체 페이지 스타일 */
    body {
      font-family: 'Comic Sans MS', sans-serif;
      background: #e8f5e9; /* 연한 민트 그린 배경 */
      color: #2e7d32; /* 진한 녹색 텍스트 */
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column; /* 세로 방향으로 요소들을 배치 */
    }

    /* 메인 컨텐츠 영역 */
    main {
      flex: 1; /* 남은 공간을 모두 차지하도록 설정 */
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px 0;
    }

    /* 컨테이너: 모바일 화면 중앙 정렬 */
    #quiz-container, #result {
      max-width: 430px; /* 아이폰 16 너비로 변경 */
      width: calc(100% - 32px); /* 패딩을 고려한 전체 너비 */
      margin: 20px auto;
      padding: 24px 16px;
      background: #f1f8e9; /* 매우 연한 연두색 배경 */
      border: 2px solid #aed581; /* 파스텔 연두색 테두리 */
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      text-align: center;
      box-sizing: border-box; /* 패딩을 너비에 포함 */
    }

    /* 질문 텍스트 */
    .question {
      font-size: 18px;
      margin-bottom: 20px;
      text-align: left;
      line-height: 1.5;
    }

    /* 질문 이미지 컨테이너 수정 */
    .question-image {
      width: 100%;
      min-height: calc(100vw * 2.5 / 3); /* 최소 높이를 현재 비율로 설정 */
      max-height: calc(100vw * 1.2); /* 너무 길어지지 않도록 제한 */
      margin: 20px 0;
      background-color: #dcedc8;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .question-image img {
      width: 100%;
      height: 100%;
      object-fit: contain; /* cover에서 contain으로 변경하여 이미지가 잘리지 않도록 */
      border-radius: 8px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .question-image img.loaded {
      opacity: 1;
    }

    /* 보기 버튼 */
    .option {
      display: block;
      margin: 10px 0;
      padding: 16px;
      background: #dcedc8;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      text-align: left;
      color: #33691e;
      opacity: 1;
      transition: all 0.3s ease;
    }
    .option:hover {
      background: #c5e1a5; /* 호버 시 약간 진한 연두색 */
      transform: translateX(5px);
    }

    /* 결과 창 */
    #result {
      display: none;
      max-width: 430px;
      width: calc(100% - 32px);
      margin: 20px auto;
      padding: 24px 16px;
      background: #f1f8e9;
      border: 2px solid #aed581;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      box-sizing: border-box;
    }

    .result-title {
      font-size: 24px;
      color: #2e7d32;
      margin-bottom: 20px;
      text-align: center;
    }

    /* 결과 이미지 컨테이너 수정 */
    .result-image {
      width: 100%;
      min-height: calc(100vw * 2.5 / 3);
      max-height: calc(100vw * 1.2);
      margin: 20px 0;
      background-color: #dcedc8;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .result-image img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 8px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .result-image img.loaded {
      opacity: 1;
    }

    .result-button {
      display: block;
      width: 100%;
      padding: 16px;
      background: #aed581;
      color: #33691e;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .result-button:hover {
      background: #c5e1a5;
    }

    .share-button {
      margin-top: 8px;
      background: #81c784; /* 약간 다른 녹색 계열로 구분 */
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .share-button:hover {
      background: #a5d6a7;
    }

    .share-button::before {
      content: '📱';
      font-size: 16px;
    }

    /* 시작 화면 스타일 */
    #start-container {
      width: 100%;
      min-height: calc(100vh - 40px - 80px); /* 헤더와 푸터 높이를 제외한 높이 */
      background-image: url('background.webp'); /* 배경 이미지 추가 */
      background-size: cover;
      background-position: center;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 40px 20px;
      box-sizing: border-box;
    }

    .title {
      font-size: 32px;
      font-weight: bold;
      color: #fff; /* 배경 이미지에 따라 조절 필요 */
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      margin-top: 40px;
    }

    .start-button {
      background: #aed581;
      color: #33691e;
      border: none;
      padding: 15px 40px;
      font-size: 20px;
      border-radius: 25px;
      cursor: pointer;
      margin-bottom: 40px;
      transition: background 0.3s ease;
    }

    .start-button:hover {
      background: #c5e1a5;
    }

    /* 탑바 스타일 수정 */
    .topbar {
      position: static; /* fixed에서 static으로 변경 */
      height: 40px;
      background: rgba(241, 248, 233, 0.95);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 16px;
      border-bottom: 1px solid #aed581;
    }

    .language-switcher {
      display: flex;
      gap: 8px;
      font-size: 14px;
      color: #33691e;
    }

    .language-btn {
      background: none;
      border: none;
      padding: 4px;
      cursor: pointer;
      color: #33691e;
      opacity: 0.5;
      font-size: 14px;
    }

    .language-btn.active {
      opacity: 1;
      font-weight: bold;
    }

    /* 점수 표시 스타일 추가 */
    .score-text {
      font-size: 14px;
      color: #33691e;
      text-align: center;
      margin-bottom: 12px;
      opacity: 0.8;
    }

    /* 스켈레톤 로딩 애니메이션 스타일 추가 */
    @keyframes shimmer {
      0% {
        background-position: -200% 0;
      }
      100% {
        background-position: 200% 0;
      }
    }

    .skeleton {
      background: linear-gradient(90deg, 
        #dcedc8 25%, 
        #e8f5e9 50%, 
        #dcedc8 75%
      );
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .music-guide {
      font-size: 12px;
      color: #33691e;
      opacity: 0.8;
    }

    .music-button {
      background: none;
      border: none;
      padding: 4px;
      cursor: pointer;
      font-size: 14px;
      color: #33691e;
      transition: transform 0.2s ease;
    }

    .music-button:hover {
      transform: scale(1.1);
    }

    /* 이미지 출처 스타일 추가 */
    .image-credit {
      font-size: 10px;
      color: #33691e;
      opacity: 0.6;
      text-align: right;
      margin-top: 4px;
      font-style: italic;
    }

    .image-credit a {
      color: inherit;
      text-decoration: none;
    }

    .image-credit a:hover {
      text-decoration: underline;
    }

    /* 푸터 스타일 수정 */
    .footer {
      width: 100%;
      padding: 20px 16px;
      background: rgba(241, 248, 233, 0.95);
      border-top: 1px solid #aed581;
      text-align: center;
      position: static; /* fixed에서 static으로 변경 */
      font-size: 12px;
      color: #33691e;
      box-sizing: border-box;
    }

    .footer-content {
      max-width: 430px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 16px;
    }

    .footer a {
      color: #33691e;
      text-decoration: none;
      transition: opacity 0.3s ease;
    }

    .footer a:hover {
      opacity: 0.7;
    }

    /* 기존 컨테이너들의 하단 여백 수정 */
    #quiz-container, #result {
      margin-bottom: 20px; /* 80px에서 20px로 변경 */
    }

    #start-container {
      padding-bottom: 20px; /* 80px에서 20px로 변경 */
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-left">
      <span class="music-guide">🎵 BGM을 듣고 싶다면 </span>
      <button id="musicToggle" class="music-button">
        🔈
      </button>
      <span class="music-guide">을 눌러주세요</span>
    </div>
    <div class="language-switcher">
      <button class="language-btn active" onclick="changeLanguage('ko')" data-lang="ko">ko</button>
      |
      <button class="language-btn" onclick="changeLanguage('en')" data-lang="en">en</button>
    </div>
  </div>

  <audio id="bgm" loop autoplay>
    <source src="background.mp3" type="audio/mp3" preload="auto">
  </audio>

  <main>
    <div id="start-container">
      <h1 class="title">Chill Guy 측정기</h1>
      <button class="start-button" onclick="startQuiz()">측정</button>
    </div>

    <div id="quiz-container">
      <!-- 질문과 보기 -->
    </div>

    <div id="result">
      <h2 class="result-title"><span id="result-text"></span></h2>
      <div class="result-image skeleton">
        <img 
          src="${getResultImage()}" 
          alt="Result Image" 
          style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;"
          onload="this.classList.add('loaded'); this.parentElement.classList.remove('skeleton')"
        >
      </div>
      <button class="result-button" onclick="restartQuiz()">다시 시작하기</button>
      <button class="result-button share-button" onclick="shareToInstagramStory()">Instagram Story 공유</button>
    </div>
  </main>

  <footer class="footer">
    <div class="footer-content">
      <div class="footer-links">
        <a href="https://github.com/limcpf/Chill-guy-test" target="_blank">GitHub</a>
        <span>|</span>
        <a href="mailto:daeseong0226@gmail.com">Contact</a>
        <span>|</span>
        <a href="#" onclick="showPrivacyPolicy()">개인정보처리방침</a>
      </div>
      <div>© 2024 Chill Guy 측정기 - Made with 🧊 by limcpf</div>
    </div>
  </footer>

  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <script>
    // 언어 데이터 추가
    const translations = {
      ko: {
        title: 'Chill Guy 측정기',
        startButton: '측정',
        restartButton: '다시 시작하기',
        saveButton: '결과 저장하기',
        questions: [
          {
            question: "당신은 선풍기 바람이 직방으로 오지 않아 땀이 흐르고 있습니다. 어떻게 대처하시겠습니까?",
            image: "q1.webp",
            options: [
              { text: "그냥 더운 건 자연의 일부라고 생각하며 땀을 흘린다. 이것이 여름이다.", score: 3 },
              { text: "선풍기 근처로 이동하며 자연스럽게 바람을 받는다. 마치 우주의 흐름처럼.", score: 2 },
              { text: "가까운 부채를 찾아들고 천천히 부채질한다. 천천히.", score: 1 },
              { text: "땀을 닦으며 창문을 열고 밖을 본다. 멍 때리는 게 최고다.", score: 0 },
            ],
          },
          {
            question: "친구가 약속 시간에 30분이나 늦었습니다. 당신의 반응은?",
            image: "q2.webp",
            options: [
              { text: "괜찮아, 나도 방금 왔어~ (사실 제시간에 도착했다)", score: 3 },
              { text: "기다리는 동안 여유롭게 음악을 듣고 있었어", score: 2 },
              { text: "커피 한 잔 마시면서 기다리고 있었어", score: 1 },
              { text: "다음부턴 일찍 와줬으면 좋겠다~ (웃으며)", score: 0 },
            ],
          },
          {
            question: "일이 너무 많아 야근을 해야 할 것 같습니다. 어떻게 하시겠습니까?",
            image: "q3.webp",
            options: [
              { text: "내일의 나에게 선물을 주자. 오늘은 집에 간다", score: 3 },
              { text: "할 수 있는 만큼만 하고 가자. 건강이 최고다", score: 2 },
              { text: "조금만 더 하다가 가야겠다. 스트레스 받지 말자", score: 1 },
              { text: "빨리 끝내고 가자. 열심히 하면 된다", score: 0 },
            ],
          },
          {
            question: "주말에 갑자기 약속이 취소되었습니다. 당신은?",
            image: "q4.webp",
            options: [
              { text: "오히려 좋아. 집이 최고야", score: 3 },
              { text: "좋은 기회군. 나만의 시간을 가지자", score: 2 },
              { text: "다른 친구를 만날까? 아니야, 그냥 쉬자", score: 1 },
              { text: "다음을 기약하며 넷플릭스를 본다", score: 0 },
            ],
          },
          {
            question: "길가다가 발에 껌이 붙었습니다. 당신의 반응은?",
            image: "q5.avif",
            imageBy: {
              name: "TikTok",
              url: "https://www.tiktok.com/@y2mmem/video/7442305398587034912"
            },
            options: [
              { text: "이것도 인생의 일부지 뭐~ 천천히 떼면 되지", score: 3 },
              { text: "귀찮네~ 그래도 어쩔 수 없지", score: 2 },
              { text: "근처 편의점에서 물티슈를 사자", score: 1 },
              { text: "아... 짜증나네. 빨리 떼야겠다", score: 0 },
            ],
          },
          {
            question: "퇴근길에 엄청난 traffic jam에 걸렸습니다. 당신은?",
            image: "q6.webp",
            options: [
              { text: "차가 막히네~ 음악이나 들으면서 가자", score: 3 },
              { text: "이 시간에 명상이나 해볼까?", score: 2 },
              { text: "우회도로를 찾아보자. 천천히", score: 1 },
              { text: "다음부턴 이 시간은 피해서 가야지", score: 0 },
            ],
          },
          {
            question: "당신의 인생 모토는?",
            image: "q7.webp",

            options: [
              { text: "인생은 흘러가는 대로. 모든 게 Fine해", score: 3 },
              { text: "천천히 가도 괜찮아. 결국 다 잘될 거야", score: 2 },
              { text: "긍정적으로 생각하면 긍정적인 일이 생겨", score: 1 },
              { text: "열심히 살자. 그래도 여유롭게", score: 0 },
            ],
          },
        ],
        results: {
          score21: {
            text: "✨ 세상 모든 게 Fine해. 네 주변은 언제나 Chill한 에너지로 가득해",
            image: "score21.webp",

          },
          score20: {
            text: "🌊 평화로운 흐름 그 자체. 네가 있는 곳이 바로 Chill Zone이야",
            image: "score20.webp",

          },
          score18: {
            text: "🧘‍♂️ 완벽하진 않아도 Fine해. 네 안의 평화가 곧 Chill이니까",
            image: "score18.webp",

          },
          score16: {
            text: "🍃 자유롭게 흘러가는 중. Everything's Chill, Everything's Fine",
            image: "score16.webp",

          },
          score13: {
            text: "👀 천천히 바라보는 네 방식이 Fine해. 그게 바로 진정한 Chill",
            image: "score13.webp",

          },
          score10: {
            text: "⚖️ 밸런스의 달인. 어떤 순간에도 Chill하게 받아들여",
            image: "score10.webp",

          },
          score7: {
            text: "🎮 여유로운 미소가 매력이야. Keep Calm and Stay Chill",
            image: "score7.webp",

          },
          score4: {
            text: "🤔 깊은 생각도 Fine해. 그 속에서 찾은 평화가 너만의 Chill",
            image: "score4.webp",

          },
          score0: {
            text: "⚡ 열정 가득한 게 Fine해. 그래도 마음만은 언제나 Chill",
            image: "score0.webp",

          }
        }
      },
      en: {
        title: 'Chill Guy Test',
        startButton: 'Start',
        restartButton: 'Restart',
        saveButton: 'Save Result',
        questions: [
          {
            question: "You're sweating because the fan isn't blowing directly at you. How do you handle it?",
            image: "q1.webp",
            options: [
              { text: "Just sweat it out. Sweating is part of nature. This is summer.", score: 3 },
              { text: "Move near the fan naturally to catch the breeze. Like the flow of the universe.", score: 2 },
              { text: "Find a nearby hand fan and fan yourself slowly. Take it easy.", score: 1 },
              { text: "Wipe off the sweat and open the window to space out. That's the best.", score: 0 },
            ],
          },
          {
            question: "Your friend is 30 minutes late for the appointment. How do you react?",
            image: "q2.webp",
            options: [
              { text: "It's okay, I just got here too~ (Actually arrived on time)", score: 3 },
              { text: "I was just enjoying some music while waiting", score: 2 },
              { text: "I was having a coffee while waiting", score: 1 },
              { text: "Hope you can come earlier next time~ (with a smile)", score: 0 },
            ],
          },
          {
            question: "You might need to work overtime due to too much work. What would you do?",
            image: "q3.webp",

            options: [
              { text: "Let's give tomorrow's me a gift. I'm going home now", score: 3 },
              { text: "Let's just do what we can and go. Health comes first", score: 2 },
              { text: "I'll work a bit more and then leave. No stress", score: 1 },
              { text: "Let's finish quickly and go. Working hard is the key", score: 0 },
            ],
          },
          {
            question: "Your weekend plans got suddenly canceled. What's your reaction?",
            image: "q4.webp",

            options: [
              { text: "Even better. Home is the best", score: 3 },
              { text: "Good opportunity. Let's have some me time", score: 2 },
              { text: "Should I meet another friend? Nah, let's just rest", score: 1 },
              { text: "Watch Netflix while looking forward to next time", score: 0 },
            ],
          },
          {
            question: "You stepped on gum while walking. How do you react?",
            image: "q5.avif",

            options: [
              { text: "This is just part of life~ I'll remove it slowly", score: 3 },
              { text: "What a hassle~ But can't help it", score: 2 },
              { text: "Let's buy some wet wipes from the nearby store", score: 1 },
              { text: "Ugh... annoying. Need to remove it quickly", score: 0 },
            ],
          },
          {
            question: "You're stuck in a huge traffic jam on your way home. What do you do?",
            image: "q6.webp",

            options: [
              { text: "Traffic's bad~ Let's listen to some music while driving", score: 3 },
              { text: "How about some meditation during this time?", score: 2 },
              { text: "Let's look for a detour. Slowly", score: 1 },
              { text: "Should avoid this time next time", score: 0 },
            ],
          },
          {
            question: "What's your life motto?",
            image: "q7.webp",

            options: [
              { text: "Go with the flow. Everything's Fine", score: 3 },
              { text: "It's okay to go slow. Everything will work out", score: 2 },
              { text: "Think positive and positive things will happen", score: 1 },
              { text: "Work hard but stay relaxed", score: 0 },
            ],
          },
        ],
        results: {
          score21: {
            text: "✨ Everything's Fine around you. Your presence brings the ultimate Chill vibes",
            image: "score21.webp",

          },
          score20: {
            text: "🌊 Pure peace in motion. Wherever you are becomes the Chill Zone",
            image: "score20.webp",

          },
          score18: {
            text: "🧘‍♂️ Perfectly imperfect and Fine. Your inner peace is pure Chill",
            image: "score18.webp",

          },
          score16: {
            text: "🍃 Going with the flow. Everything's Chill, Everything's Fine",
            image: "score16.webp",

          },
          score13: {
            text: "👀 Taking it slow is Fine. That's what makes you genuinely Chill",
            image: "score13.webp",

          },
          score10: {
            text: "⚖️ Master of balance. Keeping it Chill in every moment",
            image: "score10.webp",

          },
          score7: {
            text: "🎮 That peaceful smile says it all. Keep Calm and Stay Chill",
            image: "score7.webp",

          },
          score4: {
            text: "🤔 Deep thoughts are Fine. Finding your Chill in contemplation",
            image: "score4.webp",

          },
          score0: {
            text: "⚡ Passionate soul with a Chill mind. That's perfectly Fine",
            image: "score0.webp",

          }
        }
      }
    };

    let currentLang = 'ko';

    // 언어 변경 함수
    function changeLanguage(lang) {
      currentLang = lang;
      
      // 버튼 활성화 상태 변경
      document.querySelectorAll('.language-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
      });
      
      // 현재 화면 상태에 따라 텍스트 업데이트
      updateTexts();
    }

    // 텍스트 업데이트 함수
    function updateTexts() {
      const t = translations[currentLang];
      
      // 시작 화면 텍스트 업데이트
      document.querySelector('.title').textContent = t.title;
      document.querySelector('.start-button').textContent = t.startButton;
      
      // 현재 보이는 화면에 따라 텍스트 업데이트
      if (quizContainer.style.display === 'block') {
        renderQuestion(); // 현재 질문 다시 렌더링
      } else if (resultContainer.style.display === 'block') {
        showResult(); // 결과 다시 렌더링
      }
      
      // 버튼 텍스트 업데이트
      document.querySelectorAll('.result-button').forEach(btn => {
        if (btn.onclick.toString().includes('restartQuiz')) {
          btn.textContent = t.restartButton;
        } else if (btn.onclick.toString().includes('saveAsImage')) {
          btn.textContent = t.saveButton;
        }
      });
    }

    let currentQuestionIndex = 0;
    let totalScore = 0;

    const quizContainer = document.getElementById("quiz-container");
    const resultContainer = document.getElementById("result");
    const resultText = document.getElementById("result-text");

    // 배열 섞기 함수
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // 질문 화면 렌더링
    function renderQuestion() {
      const currentQuestion = translations[currentLang].questions[currentQuestionIndex];
      const shuffledOptions = shuffleArray([...currentQuestion.options]);
      
      const questionNumber = currentQuestionIndex === translations[currentLang].questions.length - 1 
        ? 'Chill.' 
        : `${currentQuestionIndex + 1}.`;
      
      quizContainer.innerHTML = `
        <div class="question">
          ${questionNumber} ${currentQuestion.question}
        </div>
        <div class="question-image skeleton">
          <img 
            src="${currentQuestion.image}" 
            alt="Question Image" 
            style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;"
            onload="this.classList.add('loaded'); this.parentElement.classList.remove('skeleton')"
          >
        </div>
        ${currentQuestion.imageBy ? `
          <div class="image-credit">
            Image by <a href="${currentQuestion.imageBy.url}" target="_blank" rel="noopener">${currentQuestion.imageBy.name}</a>
          </div>
        ` : ''}
        ${shuffledOptions
          .map(
            (option) => `
            <button class="option" onclick="selectOption(${option.score})">${option.text}</button>
          `
          )
          .join("")}
      `;
    }

    // 옵션 선택
    function selectOption(score) {
      const quizContainer = document.getElementById("quiz-container");
      
      // 페이드 아웃 효과 추가
      quizContainer.classList.add('fade-out');
      
      // 페이드 아웃이 완료된 후 다음 질문으로 전환
      setTimeout(() => {
        totalScore += score;
        currentQuestionIndex++;
        
        if (currentQuestionIndex < translations[currentLang].questions.length) {
          renderQuestion();
          // 페이드 인 효과
          quizContainer.classList.remove('fade-out');
        } else {
          showResult();
        }
      }, 300); // 트랜지션 시간과 동일하게 설정
    }

    // 결과 보여주기
    function showResult() {
      quizContainer.style.display = "none";
      let resultMessage = "";
      const t = translations[currentLang];
      
      if (totalScore >= 21) {
        resultMessage = t.results.score21.text;
      } else if (totalScore === 20) {
        resultMessage = t.results.score20.text;
      } else if (totalScore >= 18) {
        resultMessage = t.results.score18.text;
      } else if (totalScore >= 16) {
        resultMessage = t.results.score16.text;
      } else if (totalScore >= 13) {
        resultMessage = t.results.score13.text;
      } else if (totalScore >= 10) {
        resultMessage = t.results.score10.text;
      } else if (totalScore >= 7) {
        resultMessage = t.results.score7.text;
      } else if (totalScore >= 4) {
        resultMessage = t.results.score4.text;
      } else {
        resultMessage = t.results.score0.text;
      }
      
      const resultData = getResultData();
      
      resultContainer.innerHTML = `
        <div class="score-text">${currentLang === 'ko' ? `너의 점수는 ${totalScore}점이야.` : `Your score is ${totalScore}.`}</div>
        <h2 class="result-title">${resultMessage}</h2>
        <div class="result-image skeleton">
          <img 
            src="${resultData.image}" 
            alt="Result Image" 
            style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;"
            onload="this.classList.add('loaded'); this.parentElement.classList.remove('skeleton')"
          >
        </div>
        ${resultData.imageBy ? `
          <div class="image-credit">
            Image by <a href="${resultData.imageBy.url}" target="_blank" rel="noopener">${resultData.imageBy.name}</a>
          </div>
        ` : ''}
        <button class="result-button" onclick="restartQuiz()">${t.restartButton}</button>
        <button class="result-button share-button" onclick="saveAsImage()">${t.saveButton}</button>
        <button class="result-button share-button" onclick="shareToInstagramStory()">Instagram Story 공유</button>
      `;
      
      resultContainer.style.display = "block";
    }

    // 퀴즈 다시 시작
    function restartQuiz() {
      currentQuestionIndex = 0;
      totalScore = 0;
      resultContainer.style.display = "none";
      document.getElementById('start-container').style.display = "flex";
      quizContainer.style.display = "none";
    }

    // 페이지 로드 시 초기 설정
    window.addEventListener('load', () => {
        // 초기 화면 설정
        document.getElementById('quiz-container').style.display = 'none';
        document.getElementById('result').style.display = 'none';
        document.getElementById('start-container').style.display = 'flex';

        // BGM 설정
        bgm.volume = 0.5;
        document.addEventListener('click', () => {
            if (!isMusicPlaying) {
                bgm.play();
                isMusicPlaying = true;
                musicToggle.textContent = '🔊';
            }
        }, { once: true });
    });

    // 퀴즈 시작 함수 수정
    function startQuiz() {
        document.getElementById('start-container').style.display = 'none';
        document.getElementById('quiz-container').style.display = 'block';
        document.getElementById('result').style.display = 'none';
        // 현재 언어의 질문들을 섞기
        translations[currentLang].questions = shuffleArray([...translations[currentLang].questions]);
        currentQuestionIndex = 0;
        totalScore = 0;
        renderQuestion();
    }

    // Instagram 공유 함수 추가
    function shareToInstagram() {
      // Instagram 공유 로직 구현
      // 실제 구현시에는 웹 공유 API나 딥링크를 사용해야 합니다
      alert('Instagram 공유 기능은 추후 구현될 예정입니다.');
    }

    // 이미지 저장 함수 추가
    async function saveAsImage() {
      try {
        // 저장 버튼 숨기기 (이미지에 포함되지 않도록)
        const buttons = document.querySelectorAll('.result-button');
        buttons.forEach(button => button.style.display = 'none');

        // 결과 div를 이미지로 변환
        const element = document.getElementById('result');
        const canvas = await html2canvas(element, {
          backgroundColor: '#f1f8e9',
          scale: 2, // 더 선명한 이미지를 위해 2배 크기로 렌더링
        });

        // 버튼 다시 보이게 하기
        buttons.forEach(button => button.style.display = 'block');

        // 이미지 다운로드
        const link = document.createElement('a');
        link.download = 'my-chill-result.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      } catch (err) {
        console.error('이미지 저장 중 오류가 발생했습니다:', err);
        alert('이미지 저장에 실패했습니다. 다시 시도해주세요.');
      }
    }

    // Instagram 스토리 공유 함수 추가
    async function shareToInstagramStory() {
      try {
        // 저장 버튼들 임시로 숨기기
        const buttons = document.querySelectorAll('.result-button');
        buttons.forEach(button => button.style.display = 'none');

        // 결과를 이미지로 변환
        const element = document.getElementById('result');
        const canvas = await html2canvas(element, {
          backgroundColor: '#f1f8e9',
          scale: 2,
        });

        // 버튼들 다시 표시
        buttons.forEach(button => button.style.display = 'block');

        // Canvas를 Blob으로 변환
        canvas.toBlob(async (blob) => {
          try {
            // Blob을 File로 변환
            const file = new File([blob], 'chill-guy-result.png', { type: 'image/png' });

            // Instagram 스토리 공유 딥링크 생성
            if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
              await navigator.share({
                files: [file],
                title: 'Chill Guy 측정 결과',
                text: '나의 Chill Guy 지수는?',
              });
            } else {
              // 모바일이 아니거나 공유가 지원되지 않는 경우
              const downloadLink = document.createElement('a');
              downloadLink.href = URL.createObjectURL(blob);
              downloadLink.download = 'chill-guy-result.png';
              downloadLink.click();
              
              // Instagram 앱으로 이동
              const instagramURL = 'instagram://story-camera';
              window.location.href = instagramURL;
              
              // 만약 Instagram 앱이 설치되어 있지 않다면 스토어로 이동
              setTimeout(() => {
                window.location.href = 'https://apps.apple.com/app/instagram/id389801252';
              }, 2000);
            }
          } catch (error) {
            console.error('Instagram 공유 중 오류 발생:', error);
            alert('Instagram 공유에 실패했습니다. 이미지를 저장한 후 직접 공유해주세요.');
          }
        }, 'image/png');
      } catch (error) {
        console.error('이미지 생성 중 오류 발생:', error);
        alert('이미지 생성에 실패했습니다. 다시 시도해주세요.');
      }
    }

    // BGM 관련 코드 추가
    const bgm = document.getElementById('bgm');
    const musicToggle = document.getElementById('musicToggle');
    let isMusicPlaying = false;

    // BGM 토글 함수
    function toggleMusic() {
        if (isMusicPlaying) {
            bgm.pause();
            musicToggle.textContent = '🔈';
        } else {
            bgm.play().then(() => {
                musicToggle.textContent = '🔊';
            }).catch(error => {
                console.log("음악 재생에 실패했습니다:", error);
                alert("음악 재생에 실패했습니다. 브라우저 설정을 확인해주세요.");
            });
        }
        isMusicPlaying = !isMusicPlaying;
    }

    // 음악 토글 버튼에 이벤트 리스너 추가
    musicToggle.addEventListener('click', toggleMusic);

    // 결과 이미지 가져오기 함수 추가
    function getResultImage() {
      const t = translations[currentLang];
      
      if (totalScore >= 21) {
        return t.results.score21.image;
      } else if (totalScore === 20) {
        return t.results.score20.image;
      } else if (totalScore >= 18) {
        return t.results.score18.image;
      } else if (totalScore >= 16) {
        return t.results.score16.image;
      } else if (totalScore >= 13) {
        return t.results.score13.image;
      } else if (totalScore >= 10) {
        return t.results.score10.image;
      } else if (totalScore >= 7) {
        return t.results.score7.image;
      } else if (totalScore >= 4) {
        return t.results.score4.image;
      } else {
        return t.results.score0.image;
      }
    }

    // 결과 데이터 가져오기 함수 추가
    function getResultData() {
      const t = translations[currentLang];
      
      if (totalScore >= 21) {
        return t.results.score21;
      } else if (totalScore === 20) {
        return t.results.score20;
      } else if (totalScore >= 18) {
        return t.results.score18;
      } else if (totalScore >= 16) {
        return t.results.score16;
      } else if (totalScore >= 13) {
        return t.results.score13;
      } else if (totalScore >= 10) {
        return t.results.score10;
      } else if (totalScore >= 7) {
        return t.results.score7;
      } else if (totalScore >= 4) {
        return t.results.score4;
      } else {
        return t.results.score0;
      }
    }

    // 개인정보처리방침 표시 함수
    function showPrivacyPolicy() {
      alert('이 테스트는 어떠한 개인정보도 수집하지 않습니다.\n모든 테스트 결과는 브라우저에서만 처리되며 서버에 저장되지 않습니다.');
    }
  </script>
</body>
</html>